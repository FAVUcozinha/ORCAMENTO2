<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Or√ßamento (Simula√ß√£o)</title>
    <style>
        /* ---------------------------------------------------------------------- */
        /* ESTILOS GERAIS E FONTES */
        /* ---------------------------------------------------------------------- */
        @font-face {
            font-family: 'Basic Choice 2';
            /* Assumindo que a fonte est√° na pasta 'fonts/' */
            src: url('fonts/Basic Choice 2.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        body {
            /* COR DE FUNDO AZUL */
            background-color: #7FB1C8;
            text-align: center;
            color: white;
            font-family: 'Basic Choice 2', Arial, sans-serif;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 70px;
        }

        .container {
            max-width: 600px;
            margin: auto;
        }

        img {
            width: 100%;
            height: auto;
            display: block;
            margin: 0;
        }

        header img:first-child {
            width: 100%;
            height: auto;
            display: block;
            margin: 0;
        }

        /* ---------------------------------------------------------------------- */
        /* BARRA DE NAVEGA√á√ÉO (STICKY) */
        /* ---------------------------------------------------------------------- */

        #sticky-nav-container {
            /* COR LARANJA */
            background-color: #E09F41;
            position: sticky;
            top: 0;
            z-index: 10;
            width: 100%;
            padding: 5px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        #categorias-horizontal {
            display: flex;
            overflow-x: scroll;
            padding: 5px 10px;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        /* Esconde a barra de rolagem horizontal */
        #categorias-horizontal::-webkit-scrollbar {
            display: none;
        }
        #categorias-horizontal {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        #categorias-horizontal a {
            display: inline-block;
            padding: 8px 15px;
            margin-right: 10px;
            background-color: #F4E6CB;
            color: #1A2B0F;
            text-decoration: none;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            transition: background-color 0.2s;
            flex-shrink: 0;
            scroll-snap-align: start;
        }

        /* Estilo da aba ATIVA (AZUL) */
        #categorias-horizontal a.active-link {
            background-color: #7FB1C8;
            color: white;
        }

        /* ---------------------------------------------------------------------- */
        /* ESTILOS DAS TABELAS */
        /* ---------------------------------------------------------------------- */
        .categoria-group {
            display: none;
        }
        .categoria-group.active-group {
            display: block;
        }
        .categoria-group img {
            width: 50%;
            margin: 20px auto 10px auto;
        }
        .categoria-group table {
            width: 100%;
            border-collapse: collapse;
        }
        .categoria-group tr {
            border-bottom: 1px solid #F4E6CB;
        }
        .item-group-active {
            border-bottom: none !important;
        }

        /* Definindo larguras para as colunas */
        .categoria-group:not(#grupo-cookies) th:nth-child(1), .categoria-group:not(#grupo-cookies) td:nth-child(1) { width: 50%; }
        .categoria-group:not(#grupo-cookies) th:nth-child(2), .categoria-group:not(#grupo-cookies) td:nth-child(2) { width: 15%; }
        .categoria-group:not(#grupo-cookies) th:nth-child(3), .categoria-group:not(#grupo-cookies) td:nth-child(3) { width: 15%; }
        .categoria-group:not(#grupo-cookies) th:nth-child(4), .categoria-group:not(#grupo-cookies) td:nth-child(4) { width: 20%; }

        /* AJUSTE PARA A TABELA DE COOKIES (3 COLUNAS VIS√çVEIS) */
        #tabela-cookies th:nth-child(1), #tabela-cookies td:nth-child(1) { width: 55%; } /* ITEM */
        #tabela-cookies th:nth-child(2), #tabela-cookies td:nth-child(2) { width: 20%; } /* UNID. (Pre√ßo) */
        #tabela-cookies th:nth-child(3), #tabela-cookies td:nth-child(3) { width: 25%; } /* QUANTIDADE */

        /* ATEN√á√ÉO: Corrigido o padding e vertical-align para melhor alinhamento */
        th, td {
            padding: 10px 5px;
            text-align: center;
            vertical-align: middle; /* Importante para centralizar inputs verticalmente */
            color: white;
        }

        /* Alinhamento da Coluna 1 (N√ÉO agrupada) */
        .categoria-group table:not(#tabela-prato-salgado):not(#tabela-bolo-tradicional):not(#tabela-bolo-especial) td:nth-child(1) {
            text-align: left;
            padding-left: 10px;
        }

        .item-group-cell {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
        }
        .item-nome { font-weight: bold; color: inherit; }
        .descricao { font-size: 12px; margin-top: 4px; color: inherit; }

        .erro-item-unico, .erro-categoria {
            display: none !important;
        }

        /* Estilos do Input de Quantidade na Tabela Principal */
        .quantidade-container {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: auto; /* Centraliza o container na c√©lula */
            max-width: 100px; /* Limita largura para n√£o ter inputs gigantes */
        }
        
        /* üö® AJUSTE PRINCIPAL AQUI: REMOVIDO height: 40px; e confiado no padding para dimens√£o üö® */
        .quantidade-container input[type="number"] {
            width: 100%; /* Ocupa a largura total do container (m√°ximo 100px) */
            padding: 10px 5px; /* Aumentado padding vertical para dar altura */
            font-size: 16px;
            font-family: 'Basic Choice 2', Arial, sans-serif;
            text-align: center;
            background-color: #F4E6CB;
            border: 2px solid #F4E6CB;
            color: #1A2B0F;
            border-radius: 10px;
            box-sizing: border-box;
            -moz-appearance: textfield;
            line-height: 1; /* Garante que o texto fique bem centralizado */
        }

        /* OCULTA√á√ÉO DE SETAS */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* ---------------------------------------------------------------------- */
        /* RODAP√â FIXO (RESUMO DO PEDIDO) */
        /* ---------------------------------------------------------------------- */
        #fixed-summary {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 600px;
            margin: auto;
            left: 0;
            right: 0;
            background-color: #F4E6CB;
            color: #1A2B0F;
            padding: 10px 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 50;
            display: none;
            box-sizing: border-box;
            text-align: left;
        }

        #summary-button {
            background-color: #E09F41;
            box-shadow: 0 4px #b87b2c;
        }
        #summary-button:active {
            box-shadow: 0 2px #b87b2c;
        }

        /* ---------------------------------------------------------------------- */
        /* ESTILOS DE POPUP E BOT√ïES */
        /* ---------------------------------------------------------------------- */
        .popup {
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            display: none;
        }
        .popup-conteudo {
            background-color: #F4E6CB;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 450px;
            text-align: center;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
            color: #1A2B0F;
        }
        .resumo-item-input-group input {
            /* Input de edi√ß√£o r√°pida no popup precisa da altura definida */
            width: 55px;
            height: 35px;
            padding: 5px;
        }
        #apply-desconto-btn {
            background-color: #7FB1C8;
            box-shadow: none;
        }
        
        /* Bot√µes Padr√£o (Fazer Pedido/Adicionar Itens) - COR AZUL */
        button {
            background-color: #7FB1C8;
            box-shadow: 0 4px #4c7e93;
        }

        /* Bot√£o Voltar (Laranja) */
        #botao-voltar {
            background-color: #E09F41;
            box-shadow: 0 4px #b87b2c;
            margin-bottom: 20px;
            margin-top: 20px;
        }

        /* ---------------------------------------------------------------------- */
        /* Media Queries (Mantidos) */
        /* ---------------------------------------------------------------------- */
        @media (max-width: 767px) {
            header img:nth-of-type(2) { display: none; }
            header img, footer img { width: 100%; }
        }
    </style>

</head>
<body>
    <div class="container">
        <header>
            <img src="topo.png" alt="Topo">
        </header>

        <div id="sticky-nav-container">
            <div id="categorias-horizontal">
                <a href="#grupo-bolo-tradicional" data-target="grupo-bolo-tradicional" data-img="img-bolo-tradicional">Bolos Tradicionais</a>
                <a href="#grupo-bolo-especial" data-target="grupo-bolo-especial" data-img="img-bolo-especial">Bolos Especiais</a>
                <a href="#grupo-doces" data-target="grupo-doces" data-img="img-doces">Doces</a>
                <a href="#grupo-cookies" data-target="grupo-cookies" data-img="img-cookies">Cookies</a>
                <a href="#grupo-salfri" data-target="grupo-salfri" data-img="img-salfri">Salgados Fritos</a>
                <a href="#grupo-salgado-forno" data-target="grupo-salgado-forno" data-img="img-salgado-forno">Salgados Forno</a>
                <a href="#grupo-salgado-vegetariano" data-target="grupo-salgado-vegetariano" data-img="img-salgado-vegetariano">Salgados Vegetarianos</a>
                <a href="#grupo-prato-salgado" data-target="grupo-prato-salgado" data-img="img-prato-salgado">Pratos Salgados</a>
            </div>
        </div>

        <div class="categoria-group active-group" id="grupo-bolo-tradicional">
            <img src="BOLTRA.png" alt="Bolos Tradicionais" id="img-bolo-tradicional">
            <table id="tabela-bolo-tradicional">
                <caption>Bolos Tradicionais</caption>
                <tr>
                    <th>ITEM</th>
                    <th>tamanho</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-bolo-especial">
             <img src="BOLESP.png" alt="Bolos Especiais" id="img-bolo-especial">
            <table id="tabela-bolo-especial">
                <caption>Bolos Especiais</caption>
                <tr>
                    <th>ITEM</th>
                    <th>tamanho</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tby>
            </table>
        </div>

        <div class="categoria-group" id="grupo-doces">
            <img src="DOCS.png" alt="Doces" id="img-doces">
            <table id="tabela-doces">
                <caption>Doces</caption>
                <tr>
                    <th>ITEM</th>
                    <th>Pre√ßo Unid.</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-cookies">
            <img src="cookies.png" alt="Cookies" id="img-cookies">
            <div id="erro-cookies" class="erro-categoria"></div>
            <table id="tabela-cookies">
                <caption>Cookies</caption>
                <tr>
                    <th>ITEM</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-salfri">
             <img src="salfri.png" alt="Salgados Fritos" id="img-salfri">
            <table id="tabela-salfri">
                <caption>Salgados Fritos</caption>
                <tr>
                    <th>ITEM</th>
                    <th>Pre√ßo Unid.</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-salgado-forno">
            <img src="SALFOR.png" alt="Salgados Forno" id="img-salgado-forno">
            <table id="tabela-salgado-forno">
                <caption>Salgados Forno</caption>
                <tr>
                    <th>ITEM</th>
                    <th>Pre√ßo Unid.</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-salgado-vegetariano">
             <img src="SALVEG.png" alt="Salgados Vegetarianos" id="img-salgado-vegetariano">
            <table id="tabela-salgado-vegetariano">
                <caption>Salgados Vegetarianos</caption>
                <tr>
                    <th>ITEM</th>
                    <th>Pre√ßo Unid.</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-prato-salgado">
            <img src="PRASAL.png" alt="Pratos Salgados" id="img-prato-salgado">
            <table id="tabela-prato-salgado">
                <caption>Pratos Salgados</caption>
                <tr>
                    <th>ITEM</th>
                    <th>tamanho</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tby>
            </table>
        </div>


        <button id="botao-voltar" onclick="window.location.replace('https://favucozinha.github.io/Inicio/')">Voltar</button>

        <div id="popup-resumo" class="popup">
            <div class="popup-conteudo">
                <span class="fechar" onclick="fecharResumoPopup()">&times;</span>
                <h2>SEU OR√áAMENTO</h2>

                <div id="popup-resumo-itens" class="resumo-itens"></div>

                <div id="desconto-container">
                    <strong>DESCONTO (Simula√ß√£o)</strong>
                    <div id="desconto-input-group">
                        <span style="font-size: 18px; font-weight: bold;">R$</span>
                        <input type="text" id="desconto-input" placeholder="0,00" value="0,00" oninput="formatarEAtualizarDesconto(this)">
                        <button id="apply-desconto-btn" onclick="aplicarDescontoManual()">APLICAR</button>
                    </div>
                    <div id="desconto-message" class="cupom-message"></div>
                </div>
                <div id="popup-resumo-total" class="resumo-total"></div>

                <div id="fazer-pedido-button-container">
                </div>
                <button onclick="fecharResumoPopup()">ADICIONAR ITENS</button>
            </div>
        </div>

        <div id="popup-pedido" class="popup">
            <div class="popup-conteudo">
                <span class="fechar" onclick="fecharPopup()">&times;</span>
                <h2>INFORMA√á√ïES DO PEDIDO</h2>
                <form id="form-pedido">
                    <label for="nome">NOME DO CLIENTE:</label>
                    <input type="text" id="nome" name="nome" placeholder="Nome Completo do Cliente" required>

                    <label for="data">DATA DA ENTREGA/RETIRADA:</label>
                    <input type="date" id="data" name="data" required>

                    <label for="horario">HOR√ÅRIO DA ENTREGA/RETIRADA:</label>
                    <input type="time" id="horario" name="horario" required>

                    <label for="pagamento">FORMA DE PAGAMENTO:</label>
                    <select id="pagamento" name="pagamento" required>
                        <option value="">Selecione a Forma</option>
                        <option value="Dinheiro">Dinheiro</option>
                        <option value="Cart√£o">Cart√£o</option>
                        <option value="Pix">Pix</option>
                    </select>

                    <button type="button" onclick="confirmarPedido()">ENVIAR OR√áAMENTO VIA WHATSAPP</button>
                    <button type="button" onclick="editarPedido()">EDITAR OR√áAMENTO</button>
                    <button type="button" onclick="fecharPopup()">ADICIONAR MAIS ITENS</button>
                </form>
            </div>
        </div>

        <div id="fixed-summary">
            <div class="summary-content">
                <div id="summary-text">
                    <div id="summary-total">R$ 0,00</div>
                    <span>Total Simulado</span>
                    <span id="summary-item-count"> / 0 itens</span>
                </div>
                <button id="summary-button" onclick="abrirResumoPopup()">Ver Or√ßamento</button>
            </div>
        </div>

        <footer>
            <img src="roda2.png" alt="Rodap√©">
        </footer>
    </div>

    <script>
        // Vari√°vel global para armazenar o DESCONTO em Reais (R$)
        let descontoAplicado = 0;

        // WhatsApp de destino para o resumo
        const WHATSAPP_NUMBER = '558195256641';

        // -----------------------------------------------------
        // DADOS DOS PRODUTOS (MINIMOS DEFINIDOS COMO 1 OU 0)
        // -----------------------------------------------------
        const generateId = (nome, tamanho) => {
            let base = nome.toLowerCase().replace(/[^a-z0-9]/g, '-');
            if (tamanho) {
                base += '-' + tamanho.toLowerCase().replace(/[^a-z0-9]/g, '');
            }
            return base.replace(/-+/g, '-').trim('-');
        };

        const addGroupKeys = (itens) => {
            return itens.map(item => ({
                ...item,
                groupKey: item.tamanho ? item.nome : item.id
            }));
        };

        const itensBoloTradicional = addGroupKeys([
            { nome: "Bolo de Bem-Casado", tamanho: "P (1.5 KG)", preco: 100.00, min: 1, descricaoResumo: "Bolo de Bem-Casado - P (1.5 KG)", descricao: ""},
            { nome: "Bolo de Bem-Casado", tamanho: "M (2.5 KG)", preco: 160.00, min: 1, descricaoResumo: "Bolo de Bem-Casado - M (2.5 KG)", descricao: ""},
            { nome: "Bolo de Bem-Casado", tamanho: "G (3.5 KG)", preco: 220.00, min: 1, descricaoResumo: "Bolo de Bem-Casado - G (3.5 KG)", descricao: ""},
            { nome: "Bolo de Doce de Leite", tamanho: "P (1.5 KG)", preco: 90.00, min: 1, descricaoResumo: "Bolo de Doce de Leite e Crocante de Amendoin - P (1.5 KG)", descricao: "Com Crocante de Amendoin"},
            { nome: "Bolo de Doce de Leite", tamanho: "M (2.5 KG)", preco: 150.00, min: 1, descricaoResumo: "Bolo de Doce de Leite e Crocante de Amendoin - M (2.5 KG)", descricao: "Com Crocante de Amendoin"},
            { nome: "Bolo de Doce de Leite", tamanho: "G (3.5 KG)", preco: 210.00, min: 1, descricaoResumo: "Bolo de Doce de Leite e Crocante de Amendoin - G (3.5 KG)", descricao: "Com Crocante de Amendoin"},
            { nome: "Bolo de Chocolate", tamanho: "P (1.5 KG)", preco: 90.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% Cacau - P (1.5 KG)", descricao: "Com chocolate 50% cacau"},
            { nome: "Bolo de Chocolate", tamanho: "M (2.5 KG)", preco: 150.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% Cacau - M (2.5 KG)", descricao: "Com chocolate 50% cacau"},
            { nome: "Bolo de Chocolate", tamanho: "G (3.5 KG)", preco: 210.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% Cacau - G (3.5 KG)", descricao: "Com chocolate 50% cacau"},
            { nome: "Bolo de Lim√£o", tamanho: "P (1.5 KG)", preco: 90.00, min: 1, descricaoResumo: "Bolo de Lim√£o e Chocolate Branco - P (1.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Lim√£o", tamanho: "M (2.5 KG)", preco: 150.00, min: 1, descricaoResumo: "Bolo de Lim√£o e Chocolate Branco - M (2.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Lim√£o", tamanho: "G (3.5 KG)", preco: 210.00, min: 1, descricaoResumo: "Bolo de Lim√£o e Chocolate Branco - G (3.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Maracuj√°", tamanho: "P (1.5 KG)", preco: 90.00, min: 1, descricaoResumo: "Bolo de Maracuj√° e Chocolate Branco - P (1.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Maracuj√°", tamanho: "M (2.5 KG)", preco: 150.00, min: 1, descricaoResumo: "Bolo de Maracuj√° e Chocolate Branco - M (2.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Maracuj√°", tamanho: "G (3.5 KG)", preco: 210.00, min: 1, descricaoResumo: "Bolo de Maracuj√° e Chocolate Branco - G (3.5 KG)", descricao: "Com Cholocate Branco"},
        ]).map(item => ({...item, id: generateId(item.nome, item.tamanho)}));

        const itensBoloEspecial = addGroupKeys([
            { nome: "Bolo de Ameixa", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Ameixa e Chocolate Branco - P (1.5 KG)", descricao: "Com Chocolate Branco"},
            { nome: "Bolo de Ameixa", tamanho: "M (2.5 KG)", preco: 180.00, min: 1, descricaoResumo: "Bolo de Ameixa e Chocolate Branco - M (2.5 KG)", descricao: "Com Chocolate Branco"},
            { nome: "Bolo de Ameixa", tamanho: "G (3.5 KG)", preco: 250.00, min: 1, descricaoResumo: "Bolo de Ameixa e Chocolate Branco - G (3.5 KG)", descricao: "Com Chocolate Branco"},
            { nome: "Bolo de Caf√© e Doce de Leite", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Caf√© Com Doce de Leite e Chocolate Amargo - P (1.5 KG)", descricao:"Com Chocolate Amargo"},
            { nome: "Bolo de Caf√© e Doce de Leite", tamanho: "M (2.5 KG)", preco: 180.00, min: 1, descricaoResumo: "Bolo de Caf√© Com Doce de Leite e Chocolate Amargo - M (2.5 KG)", descricao:"Com Chocolate Amargo"},
            { nome: "Bolo de Caf√© e Doce de Leite", tamanho: "G (3.5 KG)", preco: 250.00, min: 1, descricaoResumo: "Bolo de Caf√© Com Doce de Leite e Chocolate Amargo - G (3.5 KG)", descricao:"Com Chocolate Amargo"},
            { nome: "Bolo de Chocolate 50%", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% com Morangos - P (1.5 KG)", descricao:"Com Morangos"},
            { nome: "Bolo de Chocolate 50%", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% com Morangos - M (2.5 KG)", descricao:"Com Morangos"},
            { nome: "Bolo de Chocolate 50%", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% com Morangos - G (3.5 KG)", descricao:"Com Morangos"},
            { nome: "Bolo de Delicia de Abacaxi", tamanho: "P (1.5 KG)", preco: 105.00, min: 1, descricaoResumo: "Bolo de Delicia de Abacaxi - P (1.5 KG)", descricao: ""},
            { nome: "Bolo de Delicia de Abacaxi", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo de Delicia de Abacaxi - M (2.5 KG)", descricao: ""},
            { nome: "Bolo de Delicia de Abacaxi", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo de Delicia de Abacaxi - G (3.5 KG)", descricao: ""},
            { nome: "Bolo de Morango", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Morango com Brigadeiro Branco e Chantinhinho - P (1.5 KG)", descricao: "Com Recheio de Brigadeiro Branco e Cobertura de Chantininho"},
            { nome: "Bolo de Morango", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo de Morango com Brigadeiro Branco e Chantinhinho - M (2.5 KG)", descricao: "Com Recheio de Brigadeiro Branco e Cobertura de Chantininho"},
            { nome: "Bolo de Morango", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo de Morango com Brigadeiro Branco e Chantinhinho - G (3.5 KG)", descricao: "Com Recheio de Brigadeiro Branco e Cobertura de Chantininho"},
            { nome: "Bolo de Ninho trufado", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Ninho trufado - P (1.5 KG)", descricao: "Com chocolate Branco"},
            { nome: "Bolo de Ninho trufado", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo de Ninho trufado - M (2.5 KG)", descricao: "Com chocolate Branco"},
            { nome: "Bolo de Ninho trufado", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo de Ninho trufado - G (3.5 KG)", descricao: "Com chocolate Branco"},
            { nome: "Bolo Prest√≠gio", tamanho: "P (1.5 KG)", preco: 105.00, min: 1, descricaoResumo: "Bolo Prest√≠gio - P (1.5 KG)", descricao: ""},
            { nome: "Bolo Prest√≠gio", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo Prest√≠gio - M (2.5 KG)", descricao: ""},
            { nome: "Bolo Prest√≠gio", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo Prest√≠gio - G (3.5 KG)", descricao: ""},
            { nome: "Bolo Red velvet", tamanho: "P (1.5 KG)", preco: 105.00, min: 1, descricaoResumo: "Bolo Red velvet - P (1.5 KG)", descricao: ""},
            { nome: "Bolo Red velvet", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo Red velvet - M (2.5 KG)", descricao: ""},
            { nome: "Bolo Red velvet", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo Red Velvet - G (3.5 KG)", descricao: ""},
        ]).map(item => ({...item, id: generateId(item.nome, item.tamanho)}));

        const itensDoces = addGroupKeys([
            { nome: "Beijinho", min: 1, preco: 1.20, descricaoResumo: "Beijinho", descricao: "" },
            { nome: "Bem-casado", min: 1, preco: 1.20, descricaoResumo: "Bem-casado", descricao: "" },
            { nome: "Brigadeiro", min: 1, preco: 1.20, descricaoResumo: "Brigadeiro", descricao: "" },
            { nome: "Mini Tortilete", min: 1, preco: 1.30, descricaoResumo: "Mini Tortilete", descricao: "" },
            { nome: "Moranguinho", min: 1, preco: 1.20, descricaoResumo: "Moranguinho", descricao: "" },
            { nome: "Ouri√ßo", min: 1, preco: 1.30, descricaoResumo: "Ouri√ßo", descricao: "" },
            { nome: "Queijadinha", min: 1, preco: 1.30, descricaoResumo: "Queijadinha", descricao: "" },
            { nome: "Surpresa de uva", min: 1, preco: 1.30, descricaoResumo: "Surpresa de uva", descricao: "" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensCookies = addGroupKeys([
            { nome: "Cookie Tradicional", min: 1, preco: 12.00, descricaoResumo: "Cookie Tradicional", descricao: "Massa de baunilha com peda√ßos de chocolate meio amargo" },
            { nome: "Cookie Red Velvet", min: 1, preco: 12.00, descricaoResumo: "Cookie Red Velvet", descricao: "Massa de baunilha com toque de cream cheese, cacau vermelho e peda√ßos de chocolate branco" },
            { nome: "Cookie Black", min: 1, preco: 12.00, descricaoResumo: "Cookie Black", descricao: "Massa feita com cacau 100% e peda√ßos de chocolate meio amargo" },
            { nome: "Cookie Romeu e Julieta", min: 1, preco: 12.00, descricaoResumo: "Cookie Romeu e Julieta", descricao: "Massa de baunilha com pedacinhos de queijo, recheado com cream cheese e goiabada" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensSalgadoFrito = addGroupKeys([
            { nome: "Bolinho de Bacalhau", min: 1, preco: 1.30, descricaoResumo: "Bolinho de Bacalhau", descricao: "" },
            { nome: "Bolinho de Calabresa", min: 1, preco: 1.00, descricaoResumo: "Bolinho de Calabresa", descricao: "" },
            { nome: "Bolinho de Charque", min: 1, preco: 1.20, descricaoResumo: "Bolinho de Charque", descricao: "" },
            { nome: "Coxinha de Frango", min: 1, preco: 1.00, descricaoResumo: "Coxinha de Frango", descricao: "" },
            { nome: "Croquete Misto", min: 1, preco: 1.00, descricaoResumo: "Croquere Misto", descricao: "De Presunto Com Queijo" },
            { nome: "Camar√£o Empanado", min: 1, preco: 1.50, descricaoResumo: "Camar√£o Empanado", descricao: "" },
            { nome: "Mini Quibe", min: 1, preco: 1.10, descricaoResumo: "Mini Quibe de Carne C/ Queijo", descricao: "De Carne Com Queijo" },
            { nome: "Pastel de Festa", min: 1, preco: 1.30, descricaoResumo: "Pastel de Festa", descricao: "" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensSalgadoForno = addGroupKeys([
            { nome: "Canudinho de Frango", min: 1, preco: 1.50, descricaoResumo: "Canudinho de Frango", descricao: "Massa Caseira Assada no Forno" },
            { nome: "Empadinha de Bacalhau", min: 1, preco: 1.30, descricaoResumo: "Empadinha de Bacalhau", descricao: "" },
            { nome: "Empadinha de Camar√£o", min: 1, preco: 1.30, descricaoResumo: "Empadinha de Camar√£o", descricao: "" },
            { nome: "Empadinha de Carne", min: 1, preco: 1.00, descricaoResumo: "Empadinha de Carne", descricao: "" },
            { nome: "Empadinha de Frango", min: 1, preco: 1.00, descricaoResumo: "Empadinha de Frango", descricao: "" },
            { nome: "Mini Folhado de Carne", min: 1, preco: 2.20, descricaoResumo: "Mini Folhado de Carne", descricao: "" },
            { nome: "Mini Folhado de Frango", min: 1, preco: 2.20, descricaoResumo: "Mini Folhado de Frango", descricao: "" },
            { nome: "Mini Folhado de Queijo", min: 1, preco: 2.20, descricaoResumo: "Mini Folhado de Queijo", descricao: "" },
            { nome: "Mini Folhado de Pizza", min: 1, preco: 2.20, descricaoResumo: "Mini Folhado de Pizza", descricao: "" },
            { nome: "Mini Enroladinho", min: 1, preco: 1.00, descricaoResumo: "Mini Enroladinho de salsicha", descricao: "Com Salsicha" },
            { nome: "Pastel de Forno de Bacalhau", min: 1, preco: 1.30, descricaoResumo: "Pastel de Forno de Bacalhau", descricao: "" },
            { nome: "Pastel de Forno de Camar√£o", min: 1, preco: 1.40, descricaoResumo: "Pastel de Forno de Camar√£o", descricao: "" },
            { nome: "Pastel de Forno de Carne", min: 1, preco: 1.00, descricaoResumo: "Pastel de Forno de Carne", descricao: "" },
            { nome: "Pastel de Forno de Frango", min: 1, preco: 1.00, descricaoResumo: "Pastel de Forno de Frango", descricao: "" },
            { nome: "Pastel de Forno de Queijo", min: 1, preco: 1.00, descricaoResumo: "Pastel de Forno de Queijo", descricao: "" },
            { nome: "Pastel de Forno de Pizza", min: 1, preco: 1.00, descricaoResumo: "Pastel de Forno de Pizza", descricao: "" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensSalgadoVegetariano = addGroupKeys([
            { nome: "Canudinho de Soja", min: 1, preco: 1.50, descricaoResumo: "Canudinho de Soja", descricao: "Massa Caseira Assada no Forno" },
            { nome: "Coxinha de Soja", min: 1, preco: 1.00, descricaoResumo: "Coxinha de SOJA", descricao: "" },
            { nome: "Coxinha de Caju *", min: 1, preco: 1.20, descricaoResumo: "Coxinha de CAJU", descricao: "* CONSULTAR DISPONIBILIDADE *" },
            { nome: "Empadinha de Creme de Aborbinha", min: 1, preco: 1.00, descricaoResumo: "Empadinha de Aborbinha Com Queijo", descricao: "Com Queijo" },
            { nome: "Empadinha de Falso Camar√£o", min: 1, preco: 1.00, descricaoResumo: "Empadinha de Falso Camar√£o", descricao: "A Base de Milho e Leite de Coco" },
            { nome: "Pastel de Festa Vegetariano", min: 1, preco: 1.30, descricaoResumo: "Pastel de Festa de SOJA", descricao: "De Soja" },
            { nome: "Pastel de Forno Creme de Abobrinha", min: 1, preco: 1.00, descricaoResumo: "Pastel de Forno Abobrinha C/ Queijo", descricao: "Com Queijo" },
            { nome: "Pastel de Forno Caju *", min: 1, preco: 1.30, descricaoResumo: "Pastel de Forno Caju", descricao: "* CONSULTAR DISPONIBILIDADE *" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensPratoSalgado = addGroupKeys([
            { nome: "Empad√£o de Bacalhau", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Empad√£o de Bacalhau - P (1 KG)", descricao: ""},
            { nome: "Empad√£o de Bacalhau", tamanho: "M (2 KG)", preco: 220.00, min: 1, descricaoResumo: "Empad√£o de Bacalhau - M (2 KG)", descricao: ""},
            { nome: "Empad√£o de Bacalhau", tamanho: "G (3 KG)", preco: 340.00, min: 1, descricaoResumo: "Empad√£o de Bacalhau - G (3 KG)", descricao: ""},
            { nome: "Empad√£o de Carne", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Empad√£o de Carne - P (1 KG)", descricao: ""},
            { nome: "Empad√£o de Carne", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Empad√£o de Carne - M (2 KG)", descricao: ""},
            { nome: "Empad√£o de Carne", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Empad√£o de Carne - G (3 KG)", descricao: ""},
            { nome: "Empad√£o de Camar√£o", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Empad√£o de Camar√£o - P (1 KG)", descricao: ""},
            { nome: "Empad√£o de Camar√£o", tamanho: "M (2 KG)", preco: 220.00, min: 1, descricaoResumo: "Empad√£o de Camar√£o - M (2 KG)", descricao: ""},
            { nome: "Empad√£o de Camar√£o", tamanho: "G (3 KG)", preco: 340.00, min: 1, descricaoResumo: "Empad√£o de Camar√£o - G (3 KG)", descricao: ""},
            { nome: "Empad√£o de Frango", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Empad√£o de Frango - P (1 KG)", descricao: ""},
            { nome: "Empad√£o de Frango", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Empad√£o de Frango - M (2 KG)", descricao: ""},
            { nome: "Empad√£o de Frango", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Empad√£o de Frango - G (3 KG)", descricao: ""},
            { nome: "Fricass√™ de Frango", tamanho: "P (1 KG)", preco: 80.00, min: 1, descricaoResumo: "Fricass√™ de Frango - P (1 KG)", descricao: ""},
            { nome: "Fricass√™ de Frango", tamanho: "M (2 KG)", preco: 160.00, min: 1, descricaoResumo: "Fricass√™ de Frango - M (2 KG)", descricao: ""},
            { nome: "Fricass√™ de Frango", tamanho: "G (3 KG)", preco: 240.00, min: 1, descricaoResumo: "Fricass√™ de Frango - G (3 KG)", descricao: ""},
            { nome: "Quiche de Camar√£o", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Quiche de Camar√£o - P (1 KG)", descricao: ""},
            { nome: "Quiche de Camar√£o", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Quiche de Camar√£o - M (2 KG)", descricao: ""},
            { nome: "Quiche de Camar√£o", tamanho: "G (3 KG)", preco: 360.00, min: 1, descricaoResumo: "Quiche de Camar√£o - G (3 KG)", descricao: ""},
            { nome: "Quiche de Frango", tamanho: "P (1 KG)", preco: 90.00, min: 1, descricaoResumo: "Quiche de Frango - P (1 KG)", descricao: "Com Alho Por√≥"},
            { nome: "Quiche de Frango", tamanho: "M (2 KG)", preco: 180.00, min: 1, descricaoResumo: "Quiche de Frango - M (2 KG)", descricao: "Com Alho Por√≥"},
            { nome: "Quiche de Frango", tamanho: "G (3 KG)", preco: 260.00, min: 1, descricaoResumo: "Quiche de Frango - G (3 KG)", descricao: "Com Alho Por√≥"},
            { nome: "Rocambole de Bacalhau", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Rocambole de Bacalhau - P (1 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Bacalhau", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Rocambole de Bacalhau - M (2 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Bacalhau", tamanho: "G (3 KG)", preco: 360.00, min: 1, descricaoResumo: "Rocambole de Bacalhau - G (3 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Camar√£o", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Rocambole de Camar√£o - P (1 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Camar√£o", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Rocambole de Camar√£o - M (2 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Camar√£o", tamanho: "G (3 KG)", preco: 365.00, min: 1, descricaoResumo: "Rocambole de Camar√£o - G (3 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Carne", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Rocambole de Carne - P (1 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Carne", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Rocambole de Carne - M (2 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Carne", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Rocambole de Carne - G (3 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Frango", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Rocambole de Frango - P (1.5 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Frango", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Rocambole de Frango - M (2 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Frango", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Rocambole de Frango - G (3 KG)", descricao: "Massa de Batata"},
            { nome: "Torta Salgada de Bacalhau", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Torta Salgada de Bacalhau - P (1 KG)", descricao: ""},
            { nome: "Torta Salgada de Bacalhau", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Torta Salgada de Bacalhau - M (2 KG)", descricao: ""},
            { nome: "Torta Salgada de Bacalhau", tamanho: "G (3 KG)", preco: 360.00, min: 1, descricaoResumo: "Torta Salgada de Bacalhau - G (3 KG)", descricao: ""},
            { nome: "Torta Salgada de Carne", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Torta Salgada de Carne - P (1 KG)", descricao: ""},
            { nome: "Torta Salgada de Carne", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Torta Salgada de Carne - M (2 KG)", descricao: ""},
            { nome: "Torta Salgada de Carne", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Torta Salgada de Carne - G (3 KG)", descricao: ""},
            { nome: "Torta Salgada de Camar√£o", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Torta Salgada de Camar√£o - P (1 KG)", descricao: ""},
            { nome: "Torta Salgada de Camar√£o", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Torta Salgada de Camar√£o - M (2 KG)", descricao: ""},
            { nome: "Torta Salgada de Camar√£o", tamanho: "G (3 KG)", preco: 360.00, min: 1, descricaoResumo: "Torta Salgada de Camar√£o - G (3 KG)", descricao: ""},
            { nome: "Torta Salgada de Frango", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Torta Salgada de Frango - P (1 KG)", descricao: ""},
            { nome: "Torta Salgada de Frango", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Torta Salgada de Frango - M (2 KG)", descricao: ""},
            { nome: "Torta Salgada de Frango", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Torta Salgada de Frango - G (3 KG)", descricao: ""},
        ]).map(item => ({...item, id: generateId(item.nome, item.tamanho)}));


        const gruposItens = {
            "tabela-bolo-tradicional": { itens: itensBoloTradicional, nomeGrupo: "Bolos Tradicionais", img: "img-bolo-tradicional", minTotal: 0 },
            "tabela-bolo-especial": { itens: itensBoloEspecial, nomeGrupo: "Bolos Especiais", img: "img-bolo-especial", minTotal: 0 },
            "tabela-doces": { itens: itensDoces, nomeGrupo: "Doces", img: "img-doces", minTotal: 0 },
            "tabela-cookies": { itens: itensCookies, nomeGrupo: "Cookies", img: "img-cookies", minTotal: 0, minIndividual: 1 },
            "tabela-salfri": { itens: itensSalgadoFrito, nomeGrupo: "Salgados Fritos", img: "img-salfri", minTotal: 0 },
            "tabela-salgado-forno": { itens: itensSalgadoForno, nomeGrupo: "Salgados Assados", img: "img-salgado-forno", minTotal: 0 },
            "tabela-salgado-vegetariano": { itens: itensSalgadoVegetariano, nomeGrupo: "Salgados Vegetarianos", img: "img-salgado-vegetariano", minTotal: 0 },
            "tabela-prato-salgado": { itens: itensPratoSalgado, nomeGrupo: "Pratos Salgados", img: "img-prato-salgado", minTotal: 0 },
        };

        // -----------------------------------------------------
        // FUN√á√ïES DE CRIA√á√ÉO E ROLAGEM
        // -----------------------------------------------------

        function criarTabelaGrupo(grupo, idTabela, nomeGrupo) {
            const tabela = document.getElementById(idTabela);
            if (!tabela) return;

            let tbody = tabela.querySelector('tbody');
            if (!tbody) {
                tbody = document.createElement('tbody');
                tabela.appendChild(tbody);
            }
            tbody.innerHTML = '';

            let grupoAtual = null;
            let countGrupo = 0;

            const isGroupedTable = idTabela.includes('bolo') || idTabela.includes('prato');
            const isCookieTable = idTabela === 'tabela-cookies';
            const isPriceColumn2 = idTabela.includes('doces') || idTabela.includes('salfri') || idTabela.includes('salgado-forno') || idTabela.includes('salgado-vegetariano');


            for (let i = 0; i < grupo.length; i++) {
                const item = grupo[i];
                const tr = document.createElement("tr");

                const coluna2 = isCookieTable ? item.preco.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : (isPriceColumn2 ? item.preco.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : (item.tamanho || ''));
                const precoFormatado = item.preco.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const itemId = item.id;

                tr.id = itemId;

                let isFirstInGroup = false;

                const inputHtml = `<input type="number" value="0" min="0" data-min="1" data-preco="${item.preco}" data-resumo="${item.descricaoResumo}" data-grupo="${nomeGrupo}" data-item-id="${itemId}" class="quantidade-input">`;

                if (isGroupedTable) {
                    if (item.groupKey !== grupoAtual) {
                        grupoAtual = item.groupKey;
                        isFirstInGroup = true;
                        countGrupo = 1;
                        let j = i + 1;
                        while (j < grupo.length && grupo[j].groupKey === grupoAtual) {
                            countGrupo++;
                            j++;
                        }
                    }

                    if (item.groupKey === grupoAtual && i < grupo.length - 1 && grupo[i+1].groupKey === grupoAtual) {
                        tr.classList.add('item-group-active');
                    }

                    const celulasAgrupadas = `
                        <td>${coluna2}</td>
                        <td>R$ ${precoFormatado}</td>
                        <td>
                            <div class="quantidade-container">
                                ${inputHtml}
                            </div>
                        </td>
                    `;
                    if (isFirstInGroup) {
                        tr.innerHTML = `
                            <td rowspan="${countGrupo}" class="item-group-cell">
                                <div class="item-nome">${item.nome}</div>
                                ${item.descricao ? `<div class="descricao">${item.descricao}</div>` : ''}
                            </td>
                            ${celulasAgrupadas}
                        `;
                    } else {
                        tr.innerHTML = celulasAgrupadas;
                    }
                } else if (isCookieTable) {
                    tr.innerHTML = `
                        <td>
                            <div class="item-nome">${item.nome}</div>
                            ${item.descricao ? `<div class="descricao">${item.descricao}</div>` : ''}
                        </td>
                        <td>R$ ${precoFormatado}</td>
                        <td>
                            <div class="quantidade-container">
                                ${inputHtml}
                            </div>
                        </td>
                    `;
                } else {
                    tr.innerHTML = `
                        <td>
                            <div class="item-nome">${item.nome}</div>
                            ${item.descricao ? `<div class="descricao">${item.descricao}</div>` : ''}
                        </td>
                        <td>R$ ${coluna2}</td>
                        <td>UNID.</td>
                        <td>
                            <div class="quantidade-container">
                                ${inputHtml}
                            </div>
                        </td>
                    `;
                }

                tbody.appendChild(tr);
            }
        }

        function ativarAba(linkElement) {
            const targetGroupId = linkElement.getAttribute('data-target');
            const targetGroup = document.getElementById(targetGroupId);
            const categoriasBar = document.getElementById('categorias-horizontal');

            if (!targetGroup) return;

            categoriasBar.querySelectorAll('a').forEach(link => {
                link.classList.remove('active-link');
            });
            document.querySelectorAll('.categoria-group').forEach(group => {
                group.classList.remove('active-group');
            });

            linkElement.classList.add('active-link');
            targetGroup.classList.add('active-group');

            linkElement.scrollIntoView({ behavior: 'smooth', inline: 'center' });
        }

        function scrollToElement(targetElement) {
            if (!targetElement) return;
            document.querySelectorAll('.highlight-edit').forEach(el => {
                el.classList.remove('highlight-edit');
            });

            const mainHeader = document.querySelector('header');
            const stickyNav = document.getElementById('sticky-nav-container');

            const fixedHeight = (mainHeader ? mainHeader.offsetHeight : 0) + (stickyNav ? stickyNav.offsetHeight : 0) + 10;

            const elementPosition = targetElement.getBoundingClientRect().top + window.scrollY;
            const offsetPosition = elementPosition - fixedHeight;

            window.scrollTo({
                top: Math.max(0, offsetPosition),
                behavior: 'smooth'
            });
        }


        // -----------------------------------------------------
        // FUN√á√ïES DE DESCONTO MANUAL
        // -----------------------------------------------------

        function formatarEAtualizarDesconto(inputElement) {
            let valor = inputElement.value;
            valor = valor.replace(/[^\d,\.]/g, '');
            let valorNumerico = valor.replace(',', '.');

            const partes = valorNumerico.split('.');
            if (partes.length > 2) {
                valorNumerico = partes[0] + '.' + partes.slice(1).join('');
            }

            inputElement.value = valor.replace('.', ',');
            descontoAplicado = parseFloat(valorNumerico) || 0;
            atualizarTotal();
        }

        function aplicarDescontoManual() {
            const input = document.getElementById('desconto-input');
            let valor = input.value;
            let valorNumerico = valor.replace('.', '').replace(',', '.');
            descontoAplicado = parseFloat(valorNumerico) || 0;

            input.value = descontoAplicado.toFixed(2).replace('.', ',');

            atualizarTotal();

            const descontoMessage = document.getElementById('desconto-message');
            if (descontoAplicado > 0) {
                descontoMessage.textContent = `DESCONTO de R$ ${descontoAplicado.toFixed(2).replace('.', ',')} aplicado!`;
                descontoMessage.className = 'cupom-message cupom-success';
            } else if (descontoAplicado === 0) {
                descontoMessage.textContent = '';
                descontoMessage.className = 'cupom-message';
            } else {
                 descontoMessage.textContent = 'Valor de desconto inv√°lido. Corrija o valor.';
                 descontoMessage.className = 'cupom-message cupom-error';
            }
        }


        // -----------------------------------------------------
        // FUN√á√ïES DE EDI√á√ÉO E ATUALIZA√á√ÉO
        // -----------------------------------------------------

        function excluirItem(itemId) {
            const inputNoMain = document.querySelector(`.quantidade-input[data-item-id="${itemId}"]`);
            if (inputNoMain) {
                inputNoMain.value = "0";
                inputNoMain.dispatchEvent(new Event('input'));
            }

            if (parseFloat(document.getElementById("summary-total").textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) > 0) {
                abrirResumoPopup();
            } else {
                fecharResumoPopup();
            }
        }

        function atualizarQuantidadeDireta(inputElement) {
            const itemId = inputElement.getAttribute('data-item-id');
            const valorInput = inputElement.value.replace(/[^0-9]/g, '');
            let novaQuantidade = parseInt(valorInput) || 0;

            const inputNoMain = document.querySelector(`.quantidade-input[data-item-id="${itemId}"]`);

            if (inputNoMain) {
                if (novaQuantidade < 0) {
                    novaQuantidade = 0;
                }

                inputElement.value = novaQuantidade;
                inputNoMain.value = novaQuantidade;
                atualizarTotal();

                if (parseFloat(document.getElementById("summary-total").textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) > 0) {
                    abrirResumoPopup();
                } else {
                    fecharResumoPopup();
                }
            }
        }

        function atualizarTotal() {
            let totalBruto = 0;
            let totalItens = 0;
            const resumoItensPopup = document.getElementById("popup-resumo-itens");
            const resumoTotalPopup = document.getElementById("popup-resumo-total");
            const fixedSummary = document.getElementById("fixed-summary");
            const fazerPedidoContainer = document.getElementById("fazer-pedido-button-container");

            if (!resumoItensPopup || !fixedSummary || !fazerPedidoContainer) return;
            resumoItensPopup.innerHTML = '';

            const gruposResumo = {};

            document.querySelectorAll(".quantidade-input").forEach(input => {
                const quantidade = parseInt(input.value) || 0;
                const preco = parseFloat(input.getAttribute("data-preco")) || 0;
                const descricaoResumo = input.getAttribute("data-resumo");
                const grupo = input.getAttribute("data-grupo");
                const itemId = input.getAttribute("data-item-id");

                if (quantidade > 0) {
                    const totalItem = quantidade * preco;
                    totalBruto += totalItem;
                    totalItens += quantidade;

                    if (!gruposResumo[grupo]) gruposResumo[grupo] = [];
                    gruposResumo[grupo].push({ quantidade, preco, descricaoResumo, itemId, grupo });
                }
            });

            const descontoTotal = Math.min(Math.max(0, descontoAplicado), totalBruto);
            let totalLiquido = totalBruto - descontoTotal;

            const totalBrutoFormatado = totalBruto.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            const totalLiquidoFormatado = totalLiquido.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

            for (const grupo in gruposResumo) {
                resumoItensPopup.innerHTML += `<strong>${grupo}:</strong><br>`;
                gruposResumo[grupo].forEach(item => {
                    const precoTotalItem = item.quantidade * item.preco;
                    let precoExibicao = `R$ ${precoTotalItem.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

                    resumoItensPopup.innerHTML += `
                        <div class="resumo-item-line">
                            <div class="resumo-item-name">
                                ${item.descricaoResumo}
                                <small>${precoExibicao}</small>
                            </div>
                            <div class="resumo-item-input-group">
                                <input type="number"
                                        min="0"
                                        value="${item.quantidade}"
                                        data-item-id="${item.itemId}"
                                        onblur="atualizarQuantidadeDireta(this)">
                                un.
                            </div>
                            <div class="resumo-item-actions">
                                <button class="btn-excluir" onclick="excluirItem('${item.itemId}')">EXCLUIR</button>
                            </div>
                        </div>
                    `;
                });
            }

            if (descontoTotal > 0) {
                 resumoTotalPopup.innerHTML = `
                    <div class="resumo-total-line">SUBTOTAL: R$ ${totalBrutoFormatado}</div>
                    <div class="resumo-total-line total-com-desconto">DESCONTO: R$ ${descontoTotal.toFixed(2).replace('.', ',')}</div>
                    <div class="resumo-total">TOTAL FINAL: R$ ${totalLiquidoFormatado}</div>
                    `;
            } else {
                 resumoTotalPopup.textContent = `TOTAL: R$ ${totalBrutoFormatado}`;
                 resumoTotalPopup.innerHTML = `<div class="resumo-total">TOTAL: R$ ${totalBrutoFormatado}</div>`;
            }

            if (totalBruto > 0) {
                 fazerPedidoContainer.innerHTML = '<button onclick="abrirPopup()">CONCLUIR OR√áAMENTO</button>';
            } else {
                 fazerPedidoContainer.innerHTML = '';
                 descontoAplicado = 0;
                 document.getElementById('desconto-input').value = "0,00";
                 document.getElementById('desconto-message').textContent = '';
            }

            if (totalBruto > 0) {
                document.getElementById("summary-total").textContent = `R$ ${totalLiquidoFormatado}`;
                document.getElementById("summary-item-count").textContent = ` / ${totalItens} ${totalItens === 1 ? 'item' : 'itens'}`;
                fixedSummary.style.display = 'block';
            } else {
                document.getElementById("summary-total").textContent = `R$ 0,00`;
                document.getElementById("summary-item-count").textContent = ` / 0 itens`;
                fixedSummary.style.display = 'none';
                fecharResumoPopup();
            }
        }

        // -----------------------------------------------------
        // FUN√á√ïES POPUP E CONFIRMAR OR√áAMENTO
        // -----------------------------------------------------
        function abrirResumoPopup() {
            const descontoInput = document.getElementById('desconto-input');
            if (descontoInput) {
                descontoInput.value = descontoAplicado.toFixed(2).replace('.', ',');
                aplicarDescontoManual();
            }

            const totalText = document.getElementById("summary-total").textContent;
            const total = parseFloat(totalText.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;

            if (total > 0) {
                 document.getElementById("popup-resumo").style.display = "flex";
            } else {
                 alert("Seu or√ßamento est√° vazio. Adicione itens para visualizar o resumo!");
            }
        }

        function fecharResumoPopup() {
            document.getElementById("popup-resumo").style.display = "none";
        }

        function abrirPopup() {
            fecharResumoPopup();
            document.getElementById("popup-pedido").style.display = "flex";

            const today = new Date();
            const dateStr = today.toISOString().substring(0, 10);
            const timeStr = today.toTimeString().substring(0, 5);

            document.getElementById("data").value = document.getElementById("data").value || dateStr;
            document.getElementById("horario").value = document.getElementById("horario").value || timeStr;
        }

        function fecharPopup() {
            document.getElementById("popup-pedido").style.display = "none";
        }

        function editarPedido() {
            fecharPopup();
            abrirResumoPopup();
        }

        function resetarCampos() {
            document.querySelectorAll(".quantidade-input").forEach(input => {
                input.value = "0";
            });

            descontoAplicado = 0;
            const descontoInput = document.getElementById('desconto-input');
            if(descontoInput) descontoInput.value = "0,00";
            const descontoMessage = document.getElementById('desconto-message');
            if(descontoMessage) descontoMessage.textContent = '';

            document.getElementById("nome").value = "";
            document.getElementById("data").value = "";
            document.getElementById("horario").value = "";
            document.getElementById("pagamento").value = "";

            fecharPopup();
            fecharResumoPopup();
            atualizarTotal();
            window.scrollTo(0, 0);
        }

        function confirmarPedido() {
            const linhaSeparadora = "\n\n*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*\n\n";

            let resumoWhatsapp = "Segue o or√ßamento do seu pedido:\n\n\n*_- Resumo dos Itens:_*\n\n";
            let totalBruto = 0;

            const gruposResumo = {};
            let totalItens = 0;

            document.querySelectorAll(".quantidade-input").forEach(input => {
                const quantidade = parseInt(input.value) || 0;
                const preco = parseFloat(input.getAttribute("data-preco")) || 0;
                const descricaoResumo = input.getAttribute("data-resumo");
                const grupo = input.getAttribute("data-grupo");

                if (quantidade > 0) {
                    const totalItem = quantidade * preco;
                    totalBruto += totalItem;
                    totalItens += quantidade;

                    if (!gruposResumo[grupo]) {
                        gruposResumo[grupo] = [];
                    }
                    gruposResumo[grupo].push({ descricao: descricaoResumo, quantidade: quantidade, precoUnid: preco, precoTotal: totalItem });
                }
            });

            if (totalBruto === 0) {
                alert("Seu or√ßamento est√° vazio. Adicione itens para enviar.");
                fecharPopup();
                return;
            }

            const descontoTotal = Math.min(Math.max(0, descontoAplicado), totalBruto);
            const totalLiquido = totalBruto - descontoTotal;
            const totalLiquidoFormatado = totalLiquido.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });


            for (const grupo in gruposResumo) {
                resumoWhatsapp += `*${grupo}:*\n`;
                gruposResumo[grupo].forEach(item => {
                    const precoUnidFormatado = item.precoUnid.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    const precoTotalFormatado = item.precoTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                    resumoWhatsapp += `${item.descricao} - ${item.quantidade} un. (R$ ${precoUnidFormatado} cada) = R$ ${precoTotalFormatado}\n`;
                });
                resumoWhatsapp += `\n`;
            }

            resumoWhatsapp += `*- Total dos Itens (Bruto)*: R$ ${totalBruto.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n`;

            if (descontoTotal > 0) {
                 resumoWhatsapp += `*- Desconto Aplicado*: R$ ${descontoTotal.toFixed(2).replace('.', ',')}\n`;
            }

            resumoWhatsapp += `*_Total Final do Or√ßamento (sem taxa de entrega)_*: *R$ ${totalLiquidoFormatado}*\n`;
            resumoWhatsapp += `(Total de ${totalItens} ${totalItens === 1 ? 'item' : 'itens'})\n`;


            const nome = document.getElementById("nome").value;
            const data = document.getElementById("data").value;
            const horario = document.getElementById("horario").value;
            const pagamento = document.getElementById("pagamento").value;

            if (!nome || !data || !horario || !pagamento || pagamento === "") {
                alert("Por gentileza, preencha todos os campos do pedido (Nome, Data, Hor√°rio e Forma de Pagamento).");
                return;
            }

            const dataParts = data.split("-");
            const dataFormatada = `${dataParts[2]}/${dataParts[1]}/${dataParts[0]}`;

            resumoWhatsapp += linhaSeparadora;

            resumoWhatsapp += `_*- Informa√ß√µes para a Entrega/Retirada:*_\n\n*Nome do Cliente*: ${nome}\n*Data da Entrega/Retirada*: ${dataFormatada}\n*Hor√°rio Estimado*: ${horario}\n*Forma de Pagamento Combinada*: ${pagamento}`;

            const whatsappLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(resumoWhatsapp)}`;
            window.open(whatsappLink, '_blank');

            resetarCampos();
        }


        document.addEventListener("DOMContentLoaded", function () {

            for (const idTabela in gruposItens) {
                const tabelaId = idTabela;
                criarTabelaGrupo(gruposItens[idTabela].itens, tabelaId, gruposItens[idTabela].nomeGrupo);
            }

            document.querySelectorAll(".quantidade-input").forEach(input => {
                input.addEventListener("input", atualizarTotal);

                input.addEventListener("blur", function() {
                    const quantidade = parseInt(this.value) || 0;
                    if (this.value === "" || quantidade < 0) {
                        this.value = "0";
                    } else {
                        this.value = quantidade.toString();
                    }
                    atualizarTotal();
                });
            });

            const categoriasBar = document.getElementById('categorias-horizontal');
            const links = categoriasBar.querySelectorAll('a');

            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();

                    ativarAba(this);

                    const targetImageId = this.getAttribute('data-img');
                    const targetElement = document.getElementById(targetImageId);

                    if (targetElement) {
                        scrollToElement(targetElement);
                    }
                });
            });

            const primeiroLink = document.querySelector('#categorias-horizontal a[data-target="grupo-bolo-tradicional"]');
            const primeiroGrupo = document.getElementById('grupo-bolo-tradicional');

            if (primeiroLink) {
                primeiroLink.classList.add('active-link');
            }
            if (primeiroGrupo) {
                primeiroGrupo.classList.add('active-group');
            }

            document.addEventListener('click', function(event) {
                const popupResumo = document.getElementById('popup-resumo');
                const popupPedido = document.getElementById('popup-pedido');

                if (popupResumo && popupResumo.style.display === 'flex' && event.target === popupResumo) {
                    fecharResumoPopup();
                }

                if (popupPedido && popupPedido.style.display === 'flex' && event.target === popupPedido) {
                    fecharPopup();
                }
            });

            atualizarTotal();
        });
    </script>

</body>
</html>
